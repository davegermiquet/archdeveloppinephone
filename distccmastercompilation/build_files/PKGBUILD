pkgname=Zandronum
pkgver=3.1
pkgrel=1
pkgdesc='Zandronum Doom Like Game'
url=https://github.com/ptitSeb/zandronum
arch=('aarch64')
license=('Sleepycat License')

build() {
   rm -rf zandronum
   git clone https://github.com/ptitSeb/zandronum.git
   cp /tmp/setup/GameCompiler.patch zandronum/game-music-emu/
   cd  zandronum/game-music-emu/
   git log
   patch CMakeLists.txt < GameCompiler.patch
   cd ../../
   if [[ -d ./build ]] ; then
   cd build
   else
   mkdir build
   fi
   export CFLAGS="-mcpu=native"
   export CXXFLAGS="-mcpu=native"  
   export DISTCC_HOSTS="192.168.1.183/3 192.168.1.184/3"
   PATH=/usr/lib/distcc:$PATH cmake ../zandronum -DCMAKE_BUILD_TYPE=Release -DNO_ASM=ON -DNO_FMOD=ON -DSERVERONLY=OFF -DRELEASE_WITH_DEBUG_FILE=OFF
   make -j6
} 

package() {
   cd build
   make install
}